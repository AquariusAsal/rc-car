<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RC-Car Steuerung</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #222; color: white; }
        h1 { margin-top: 20px; }
        .controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; max-width: 300px; margin: 20px auto; }
        button { padding: 20px; font-size: 24px; border: none; border-radius: 10px; cursor: pointer; background-color: #444; color: white; touch-action: manipulation; }
        button:active { background-color: #007bff; }
        #btn-connect { background-color: #28a745; width: 80%; padding: 15px; margin-bottom: 20px; font-size: 18px; }
        #status { margin-bottom: 20px; color: #aaa; }
    </style>
</head>
<body>

    <h1>RC-Car Control</h1>
    <button id="btn-connect" onclick="connectBluetooth()">ðŸ”— Mit Auto verbinden</button>
    <p id="status">Nicht verbunden</p>

    <div class="controls">
        <div></div>
        <button onmousedown="sendCommand('F')" onmouseup="sendCommand('S')" ontouchstart="sendCommand('F')" ontouchend="sendCommand('S')">â–²</button>
        <div></div>
        
        <button onmousedown="sendCommand('L')" onmouseup="sendCommand('S')" ontouchstart="sendCommand('L')" ontouchend="sendCommand('S')">â—€</button>
        <button onmousedown="sendCommand('S')" ontouchstart="sendCommand('S')">â– </button>
        <button onmousedown="sendCommand('R')" onmouseup="sendCommand('S')" ontouchstart="sendCommand('R')" ontouchend="sendCommand('S')">â–¶</button>
        
        <div></div>
        <button onmousedown="sendCommand('B')" onmouseup="sendCommand('S')" ontouchstart="sendCommand('B')" ontouchend="sendCommand('S')">â–¼</button>
        <div></div>
    </div>

    <script>
        let bluetoothDevice;
        let characteristic;

        // Standard UUIDs fÃ¼r HM-10 Module (ggf. im Datenblatt prÃ¼fen)
        const serviceUUID = 0xFFE0;
        const charUUID = 0xFFE1;

        async function connectBluetooth() {
            try {
                document.getElementById('status').innerText = "Suche GerÃ¤t...";
                
                // 1. GerÃ¤t anfordern
                bluetoothDevice = await navigator.bluetooth.requestDevice({
                    filters: [{ services: [serviceUUID] }]
                });

                // 2. Mit Server verbinden
                const server = await bluetoothDevice.gatt.connect();
                
                // 3. Service holen
                const service = await server.getPrimaryService(serviceUUID);
                
                // 4. Characteristic holen (hier schreiben wir die Daten rein)
                characteristic = await service.getCharacteristic(charUUID);

                document.getElementById('status').innerText = "âœ… Verbunden mit " + bluetoothDevice.name;
                document.getElementById('btn-connect').style.display = 'none';

            } catch (error) {
                console.error(error);
                document.getElementById('status').innerText = "Fehler: " + error;
            }
        }

        async function sendCommand(cmd) {
            if (!characteristic) return;
            
            // Konvertiere String zu Uint8Array fÃ¼r die Ãœbertragung
            const encoder = new TextEncoder();
            const data = encoder.encode(cmd);

            try {
                await characteristic.writeValue(data);
                console.log("Gesendet: " + cmd);
            } catch (error) {
                console.log("Sende-Fehler: " + error);
            }
        }
    </script>
</body>
</html>
